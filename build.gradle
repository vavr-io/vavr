plugins {
    id 'net.researchgate.release' version '2.7.0'
}

ext.junitVersion = '5.3.1'

subprojects {

    apply plugin: 'java'
    apply plugin: 'jacoco'

    repositories {
        jcenter()
    }

    compileJava {
        sourceCompatibility = 11
        targetCompatibility = 11
        options.encoding = 'UTF-8'
        options.compilerArgs = [ '-Xlint:all', '-Werror' ]
    }

    dependencies {
        testImplementation "org.junit.jupiter:junit-jupiter-api:$junitVersion"
        testRuntimeOnly "org.junit.jupiter:junit-jupiter-engine:$junitVersion"
    }

    test {
        useJUnitPlatform()
    }

    jacocoTestReport {
        reports {
            xml.enabled = true
        }
    }

    check.dependsOn jacocoTestReport

    // TODO: REMOVE THIS WORKAROUND FOR https://github.com/jacoco/jacoco/issues/663 -->
    jacoco {
        toolVersion = "0.8.2" // intentionally no ext.jacocoVersion
    }
    // <-- TODO: REMOVE THIS WORKAROUND
}

// TODO: REMOVE THIS WORKAROUND FOR for https://github.com/researchgate/gradle-release/issues/186 -->
task build {}

release {
    buildTasks=['build']
    tagTemplate = '$name-$version'
}

task startmessage {
    doLast {
        println 'starting build'
    }
}

task printversion {
    doLast {
        println project.version
    }
}

beforeReleaseBuild.dependsOn startmessage
afterReleaseBuild.dependsOn printversion
// <-- TODO: REMOVE THIS WORKAROUND
